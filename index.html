<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ITC Token Presale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Change this to your correct path if the logo is not in root -->
  <link rel="icon" type="image/png" href="fulllogo_transparent_nobuffer.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --main-dark: #0c192d;
      --gold: #d4af37;
      --glass-bg: rgba(20, 36, 62, 0);
    }
    body {
      min-height: 100vh;
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg, #050d1f 0%, #092048 80%, #153564 100%);
      font-family: 'Inter', 'Montserrat', Arial, sans-serif;
      color: #eaf6fd;
      overflow-x: hidden;
      position: relative;
    }
    .watermark {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 540px;
      max-width: 100vw;
      opacity: 0.07;
      pointer-events: none;
      user-select: none;
      z-index: 1;
      filter: blur(1.2px) saturate(0.7);
    }
    .main-container {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 48px;
      padding: 44px 0 0 0;
      min-height: 92vh;
      z-index: 2;
      position: relative;
    }
    .left-side {
      flex: 1.2;
      max-width: 460px;
      padding-left: 38px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2vh;
    }
    .logo-header {
      display: flex;
      align-items: center;
      margin-bottom: 27px;
    }
    .logo-header img {
      height: 62px;
      width: 62px;
      border-radius: 14px;
      object-fit: contain;
      background: transparent;
      padding: 0;
      border: none;
      filter: none;
      box-shadow: none;
      -webkit-mask-image: radial-gradient(circle at 50% 50%, white 83%, transparent 100%);
      mask-image: radial-gradient(circle at 50% 50%, white 83%, transparent 100%);
    }
    .logo-header h1 {
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-size: 2.09rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.14em;
      margin: 0 0 0 19px;
      padding: 0;
    }
    .info-card {
      width: 100%;
      background: transparent;
      border: none;
      box-shadow: none;
      padding: 22px 0 6px 0;
      font-size: 1.09rem;
    }
    .info-card strong, .info-card ul { color: #43e6ff; font-weight: 700;}
    .info-card ul {
      color: #43e6ff;
      font-size: 1rem;
      margin-bottom: 0;
      margin-top: 10px;
      padding-left: 24px;
    }
    .thanks-card { color: #ffc; background: transparent; font-size: 1.06rem; }
    .thanks-card strong, .thanks-card span { color: #43e6ff;}
    .right-side {
      flex: 1.1;
      min-width: 340px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      z-index: 2;
      padding-right: 20px;
    }
    #presale-widget {
      width: 370px;
      border-radius: 18px;
      background: linear-gradient(135deg, #0a1a35 0%, #1e2d3d 35%, #2d6cf6 100%);
      box-shadow: 0px 4px 16px #111e2b27, 0 1px 3px #00ffe72c;
      padding: 35px 20px 32px 20px;
      color: #fff;
      text-align: center;
      position: relative;
      z-index: 3;
      margin: 0;
      border: 1px solid rgba(90,180,255,0.07);
      backdrop-filter: blur(10px);
    }
    .input-label {
      font-size: 16px;
      color: #a4cfff;
      text-align:left;
      margin: 7px 0 4px 0;
    }
    .buy-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 14px;
    }
    .buy-row input[type="number"] {
      width: 48%;
      padding: 10px;
      font-size: 1.05rem;
      border-radius: 10px;
      border: none;
      background: #182a47;
      color: #fafcff;
      transition: border 0.14s;
      outline: none;
      text-align: right;
    }
    .buy-row input[type="number"]:focus {
      border: 1.3px solid #22c1ff;
      background: #193869;
    }
    .after-input-label {
      font-size: 1.08em;
      color: #b7eaff;
      font-weight: 600;
    }
    button {
      width: 100%;
      border-radius: 14px;
      background: linear-gradient(90deg, #2038a8, #2d6cf6 70%);
      color: #fff;
      border: none;
      font-size: 1.09rem;
      padding: 13px 0;
      cursor:pointer;
      font-weight: 700;
      box-shadow: 0 1px 14px 0 #2fc5ff19;
      transition: background 0.23s;
      margin-top: 10px;
    }
    button:disabled { background: #25344f; color: #b3c0df;}
    #walletStatus, #buyResult { min-height: 20px; font-size: 1rem;}
    @media (max-width:1050px) {
      .main-container { flex-direction:column; align-items:center; gap:28px; padding:17px 0 0 0; }
      .left-side, .right-side {padding: 0 4vw; max-width:100vw;}
      .right-side {align-items: center; padding-right:0;}
    }
    @media (max-width:500px) {
      .main-container, #presale-widget { max-width:98vw; padding:11px;}
      .logo-header img { height: 38px; width: 38px;}
      .logo-header h1 { font-size: 1.11rem;}
    }
    #footer-bar {
      margin-top:34px; color:#a3b7d9; font-size: 15px; letter-spacing:0.9px; text-align:center;
      opacity: 0.92; margin-bottom:18px;
    }
  </style>
</head>
<body>
  <img src="fulllogo_transparent_nobuffer.png" class="watermark" alt="IT Capitals Watermark" />
  <div class="main-container">
    <div class="left-side">
      <div class="logo-header">
        <img src="fulllogo_transparent_nobuffer.png" alt="IT Capitals Logo"/>
        <h1>IT CAPITALS</h1>
      </div>
      <div class="info-card">
        <strong>Founded:</strong> February 2025<br>
        IT Capitals specializes in <strong>blockchain development</strong> and <strong>DAPP creation</strong>, IT infrastructure solutions, and advanced website management for clients aiming for digital excellence.
      </div>
      <div class="info-card">
        <strong>Introducing ITC Token:</strong><br>
        A utility token for a next-generation digital rewards and services ecosystem.
        <ul>
          <li>Earn by referring clients or using IT Capitals’ solutions</li>
          <li>Redeem ITC for premium services & exclusive features</li>
          <li>Soon: Real-world benefits—partner discounts, events, more</li>
        </ul>
        Join ITC community & unlock unique value in Web3 and IT services.
      </div>
      <div class="info-card thanks-card">
        <strong>With gratitude:</strong><br>
        Special thanks to <span class="highlighted">Mr. MM</span> for visionary ideas and helping build the foundation of IT Capitals.
      </div>
    </div>
    <div class="right-side">
      <div id="presale-widget">
        <h2 style="margin-bottom:13px;">ITC Token Presale</h2>
        <div style="font-size:1.09em;color:#43e6ff;font-weight:600; margin-bottom: 10px;">Pay with PYUSD</div>
        <div style="font-size:1em;color:#8ce0fc;margin-bottom:13px;">1 ITC = 0.5 PYUSD</div>
        <div class="buy-row">
          <span class="input-label" style="margin:0;">Buy</span>
          <input type="number" id="itcInput" min="0" step="0.01" placeholder="" autocomplete="off">
          <span class="after-input-label">ITC</span>
        </div>
        <button id="actionBtn">Connect Wallet to buy ITC</button>
        <div id="walletStatus" style="min-height:20px;"></div>
        <div id="buyResult" style="margin-top:13px;min-height:20px;"></div>
      </div>
    </div>
  </div>
  <div id="footer-bar">Powered by IT Capitals, ON, Canada.</div>
<script>
const PRESALE_CONTRACT = "0xd1887abfadc7b5de18c54a547490c8dea792686b";
const PYUSD_ADDRESS = "0xCaC524BcA292aaade2DF8A05cC58F0a65B1B3bB9";
const presaleAbi = [
  "function buyWithToken(uint256 tokenAmount, address erc20Token) external"
];
const erc20Abi = [
  "function approve(address spender, uint256 value) external returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "function decimals() view returns (uint8)"
];
let provider, signer, user, isConnected = false;
const APPROVE_GAS = 60000, BUY_GAS = 150000;

document.getElementById('actionBtn').onclick = async function() {
  const btn = document.getElementById('actionBtn');
  const buyResult = document.getElementById('buyResult');
  const status = document.getElementById('walletStatus');
  buyResult.textContent = "";
  if (!isConnected) {
    if (!window.ethereum) {
      status.textContent = "MetaMask is required.";
      return;
    }
    try {
      provider = new ethers.providers.Web3Provider(window.ethereum, "any");
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      user = await signer.getAddress();
      isConnected = true;
      status.textContent = "Connected: " + user;
      btn.textContent = "Buy ITC";
    } catch (err) {
      status.textContent = "Connect failed: " + (err.message || err);
    }
    return;
  }
  const itcAmt = document.getElementById('itcInput').value;
  if (!itcAmt || isNaN(itcAmt) || +itcAmt <= 0) {
    buyResult.textContent = "Invalid amount";
    return;
  }
  btn.disabled = true;
  status.textContent = "";
  try {
    // 1 ITC = 0.5 PYUSD (hardcoded, 18 decimals for both tokens)
    const pyusdAmount = ethers.utils.parseUnits((+itcAmt * 0.5).toString(), 18);
    const token = new ethers.Contract(PYUSD_ADDRESS, erc20Abi, signer);
    const allowance = await token.allowance(user, PRESALE_CONTRACT);
    if (allowance.lt(pyusdAmount)) {
      buyResult.textContent = "Waiting for approval in MetaMask...";
      const appTx = await token.approve(PRESALE_CONTRACT, pyusdAmount, {gasLimit: APPROVE_GAS});
      btn.textContent = "Approving PYUSD...";
      await appTx.wait();
      btn.textContent = "Buy ITC";
      buyResult.textContent = "Approval done, sending buy transaction...";
    }
    const contract = new ethers.Contract(PRESALE_CONTRACT, presaleAbi, signer);
    const itcAmountWei = ethers.utils.parseUnits(itcAmt, 18);
    const buyTx = await contract.buyWithToken(itcAmountWei, PYUSD_ADDRESS, {gasLimit: BUY_GAS});
    btn.textContent = "Processing...";
    await buyTx.wait();
    btn.textContent = "Buy ITC";
    buyResult.textContent = "✅ Transaction complete! TX: " + buyTx.hash;
  } catch(e) {
    // Try to show useful revert message for debugging, log all error details
    let customMsg = "Error: ";
    if (e && e.data && e.data.message) customMsg += e.data.message;
    else if (e && e.error && e.error.message) customMsg += e.error.message;
    else if (e && e.reason) customMsg += e.reason;
    else if (e && e.message) customMsg += e.message;
    else customMsg += "transaction failed";
    buyResult.textContent = customMsg;
    console.error(e);
    btn.textContent = isConnected ? "Buy ITC" : "Connect Wallet to buy ITC";
  }
  btn.disabled = false;
};
document.getElementById('itcInput').oninput = function() {
  document.getElementById('buyResult').textContent = "";
};
window.addEventListener('load', ()=> {
  document.getElementById('actionBtn').textContent = "Connect Wallet to buy ITC";
});
</script>
</body>
</html>
